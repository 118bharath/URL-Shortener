<!DOCTYPE html>
<html lang="en">
<%- include('partials/head') %>

    <body class="flex flex-col min-h-screen">
        <%- include('partials/header') %>

            <main class="container mx-auto px-6 py-12 flex-1 relative z-10">
                <!-- Background Elements -->
                <div class="fixed top-1/4 left-1/4 w-96 h-96 bg-neon-blue/10 rounded-full blur-[100px] -z-10"></div>
                <div class="fixed bottom-1/4 right-1/4 w-96 h-96 bg-neon-pink/10 rounded-full blur-[100px] -z-10"></div>

                <!-- Hero -->
                <div class="text-center max-w-4xl mx-auto mb-20 mt-10">
                    <h1 class="text-5xl md:text-7xl font-black text-white mb-8 tracking-tighter leading-tight">
                        COMPRESS YOUR <br>
                        <span
                            class="text-transparent bg-clip-text bg-gradient-to-r from-neon-blue via-white to-neon-green animate-pulse">DIGITAL
                            FOOTPRINT</span>
                    </h1>
                    <p class="text-xl text-gray-400 mb-12 font-light max-w-2xl mx-auto">
                        Advanced telemetry for your hyperlinks. <span class="text-neon-pink">Shorten</span>, <span
                            class="text-neon-blue">Copy</span>, and <span class="text-neon-green">Optimize</span> your
                        web presence.
                    </p>

                    <form action="/url" method="POST"
                        class="flex flex-col md:flex-row gap-4 justify-center items-stretch max-w-2xl mx-auto relative group">
                        <div
                            class="absolute inset-0 bg-gradient-to-r from-neon-blue via-neon-pink to-neon-green rounded-xl blur opacity-25 group-hover:opacity-50 transition duration-500">
                        </div>

                        <input type="url" name="url" placeholder="PASTE TRANSMISSION URL [HTTPS://...]" required
                            class="w-full md:flex-1 bg-dark border border-gray-700 text-white px-8 py-5 rounded-xl focus:outline-none focus:border-neon-blue placeholder-gray-600 font-mono relative z-10 transition-colors focus:bg-gray-900/80">

                        <% if (locals.user) { %>
                            <button type="submit"
                                class="md:w-auto px-10 py-5 bg-white text-dark font-black rounded-xl hover:bg-neon-green hover:shadow-[0_0_20px_rgba(0,255,133,0.6)] transition duration-300 relative z-10 uppercase tracking-widest flex items-center justify-center gap-2 group/btn">
                                <span>Execute</span>
                                <i class="ri-flashlight-fill group-hover/btn:animate-ping"></i>
                            </button>
                            <% } else { %>
                                <a href="/signup"
                                    class="md:w-auto px-10 py-5 bg-gray-800 text-gray-400 font-bold rounded-xl hover:bg-neon-pink hover:text-white transition duration-300 relative z-10 uppercase tracking-widest flex items-center justify-center gap-2 cursor-pointer border border-gray-700 hover:border-neon-pink">
                                    <span>Auth Req.</span>
                                    <i class="ri-lock-2-fill"></i>
                                </a>
                                <% } %>
                    </form>

                    <% if (locals.id) { %>
                        <div
                            class="mt-12 p-1 bg-gradient-to-r from-neon-green to-neon-blue rounded-2xl inline-block shadow-[0_0_30px_rgba(0,255,133,0.2)]">
                            <div class="bg-dark p-6 rounded-xl flex flex-col md:flex-row items-center gap-6">
                                <div class="text-left">
                                    <span
                                        class="text-neon-green text-xs font-bold tracking-widest uppercase block mb-1">Status:
                                        Optimized</span>
                                    <div class="flex items-center gap-2">
                                        <a href="http://localhost:3001/url/<%= id %>" target="_blank"
                                            class="text-2xl font-bold text-white hover:text-neon-blue transition-colors font-mono">
                                            http://shortio/<%= id %>
                                        </a>
                                    </div>
                                </div>
                                <button onclick="navigator.clipboard.writeText('http://shortio/<%= id %>')"
                                    class="p-3 bg-gray-800 rounded-lg hover:bg-white hover:text-dark transition-colors group"
                                    title="Copy Link">
                                    <i class="ri-file-copy-line text-xl group-hover:scale-110 transition-transform"></i>
                                </button>
                            </div>
                        </div>
                        <% } %>
                </div>

                <!-- URL Table -->
                <% if (locals.urls && urls.length> 0) { %>
                    <div
                        class="border border-neon-blue/20 rounded-2xl overflow-hidden backdrop-blur-sm bg-dark/50 shadow-2xl mt-10">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead>
                                    <tr
                                        class="bg-neon-blue/10 border-b border-neon-blue/20 text-neon-blue text-xs uppercase tracking-widest font-bold">
                                        <th class="p-6">Index</th>
                                        <th class="p-6">Short Code</th>
                                        <th class="p-6">Target Vector</th>
                                        <th class="p-6 text-center">Hits</th>
                                        <th class="p-6 text-center">Delete</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-800 font-mono text-sm">
                                    <% urls.forEach((url, index)=> { %>
                                        <tr class="hover:bg-white/5 transition duration-200 group">
                                            <td class="p-6 text-gray-500">#<%= String(index + 1).padStart(2, '0' ) %>
                                            </td>
                                            <td class="p-6">
                                                <div class="flex items-center gap-3">
                                                    <a href="http://localhost:3001/url/<%= url.shortId %>"
                                                        target="_blank"
                                                        class="text-neon-green hover:text-white transition-colors flex items-center gap-2 font-bold">
                                                        http://shortio/<%= url.shortId %>
                                                    </a>
                                                    <button
                                                        onclick="navigator.clipboard.writeText('http://shortio/<%= url.shortId %>')"
                                                        class="text-gray-500 hover:text-neon-blue transition-colors p-1 opacity-0 group-hover:opacity-100 transition-opacity"
                                                        title="Copy Link">
                                                        <i class="ri-file-copy-line text-lg"></i>
                                                    </button>
                                                </div>
                                            </td>
                                            <td
                                                class="p-6 text-gray-400 max-w-xs truncate group-hover:text-gray-200 transition-colors">
                                                <%= url.redirectURL %>
                                            </td>
                                            <td class="p-6 text-center">
                                                <span
                                                    class="inline-block px-3 py-1 bg-gray-800 rounded text-white font-bold">
                                                    <%= url.visitHistory.length %>
                                                </span>
                                            </td>
                                            <td class="p-6 text-center">
                                                <button onclick="deleteUrl('<%= url._id %>')"
                                                    class="text-gray-600 hover:text-neon-pink transition-colors transform hover:scale-125">
                                                    <i class="ri-close-circle-line text-xl"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <% }) %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <% } else if (locals.user) { %>
                        <div class="text-center py-20 border border-gray-800 rounded-2xl border-dashed">
                            <i class="ri-radar-line text-6xl text-gray-800 animate-pulse"></i>
                            <h3 class="text-gray-500 mt-4 font-mono tracking-widest">NO ACTIVE SIGNALS DETECTED</h3>
                        </div>
                        <% } %>
            </main>

            <%- include('partials/footer') %>

                <script>
                    async function deleteUrl(id) {
                        if (!confirm('CONFIRM DELETE PROTOCOL?')) return;
                        try {
                            const res = await fetch(`/url/${id}`, { method: 'DELETE' });
                            if (res.ok) window.location.reload();
                            else alert('ERROR: ACCESS DENIED');
                        } catch (err) { console.error(err); }
                    }
                </script>
    </body>

</html>